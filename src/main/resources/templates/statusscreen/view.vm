$webResourceManager.requireResourcesForContext("status-screen-resources")
<div class="aui-tabs horizontal-tabs" xmlns="http://www.w3.org/1999/html">
    <ul class="tabs-menu">
        <li class="menu-item active-tab">
            <a href="#tab-win-status-1">Тендерная инфомация</a>
        </li>
        <li class="menu-item">
            <a href="#tab-win-status-2">Финансы</a>
        </li>
    </ul>
    <div class="tabs-pane active-pane" id="tab-win-status-1">
        <h1 class="centered">Процедура № $model.getProcedureNumber()</h1>
        <div class="aui-group">
            <div class="aui-item">
                <h2 class="centered">Договор с заказчиком</h2>
                #if($model.getAgreement())
                    <table class="aui aui-table-sortable">
                        <thead>
                        <tr>
                            <th id="id" class="aui-table-column-issue-key">Ключ</th>
                            <th id="summary">Тема</th>
                            <th id="status">Статус</th>
                            <th id="action" class="aui-table-column-issue-key">Сумма</th>
                        </tr>
                        </thead>
                        <tbody>
                        #set($agreement = $model.getAgreement())
                        <tr class="aui-row-subtle">
                            <td headers="id" class="aui-table-column-issue-key"><a href="$baseURL/browse/$agreement.getKey()">$agreement.getKey()</a></td>
                            <td headers="summary">$agreement.getSummary()</td>
                            <td headers="status" class="aui-table-column-issue-key">
                                $soyRenderer.render(
                                    'jira.webresources:issue-statuses',
                                    'JIRA.Template.Util.Issue.Status.issueStatusResolver', {
                                    'issueStatus': $agreement.getStatus(),
                                    'isSubtle': false,
                                    'isCompact': false,
                                    'maxWidth': 250
                                })
                            </td>
                            <td headers="amount">
                                #set($finishAmountBuyer = $agreement.getAmount())
                        #if($finishAmountBuyer)
                                $number.format($finishAmountBuyer)
                            #end
                            </td>
                        </tr>
                        </tbody>
                    </table>
                #else
                    <h2>Договора нет</h2>
                #end
            </div>
            <div class="aui-item">
                <h2 class="centered">Договоры с поставщиками</h2>
                #if(!$model.getAgreementsList().isEmpty())
                <table class="aui aui-table-sortable">
                    <thead>
                        <tr>
                            <th id="id" class="aui-table-column-issue-key">Ключ</th>
                            <th id="summary">Тема</th>
                            <th id="status">Статус</th>
                            <th id="action" class="aui-table-column-issue-key">Сумма</th>
                        </tr>
                    </thead>
                    <tbody>
                        #set($finishAmountSeller = 0)
                        #foreach($agreement in $model.getAgreementsList())
                        <tr class="aui-row-subtle">
                            <td headers="id" class="aui-table-column-issue-key"><a href="$baseURL/browse/$agreement.getKey()">$agreement.getKey()</a>
                            </td>
                            <td headers="summary">$agreement.getSummary()</td>
                            <td headers="status" class="aui-table-column-issue-key">
                                $soyRenderer.render(
                                    'jira.webresources:issue-statuses',
                                    'JIRA.Template.Util.Issue.Status.issueStatusResolver', {
                                    'issueStatus': $agreement.getStatus(),
                                    'isSubtle': false,
                                    'isCompact': false,
                                    'maxWidth': 250
                                })
                            </td>
                            <td headers="amount">
                                #if($agreement.getAmount())
                            $number.format($agreement.getAmount())
                        #end
                            </td>
                        </tr>
                            #set($finishAmountSeller = $finishAmountSeller + $agreement.getAmount())
                        #end
                    </tbody>
                </table>
                #else
                    <h2>Договоров нет</h2>
                #end

            </div>
        </div>
        <div class="aui-group centered">
            <div class="aui-item">
                #if($finishAmountBuyer)
                    <h3>Итоговая сумма: <strong class="finish-value">$number.format($finishAmountBuyer)</strong></h3>
                #end
            </div>
            <div class="aui-item">
                #if($finishAmountSeller)
                    <h3>Итоговая сумма: <strong class="finish-value">$number.format($finishAmountSeller)</strong></h3>
                #end
            </div>
        </div>

        <div class="aui-group">
            <div class="aui-item">
                #if($model.getAgreement() && !$model.getAgreementsList().isEmpty() && $finishAmountBuyer && $finishAmountSeller )
                    #set($margin = $finishAmountBuyer - $finishAmountSeller)
                    #set($marginPercent = $margin / $finishAmountBuyer * 100)
                    <h2 class="centered">Маржа: <strong>$number.format($margin) ($number.format($marginPercent) %)</strong></h2>
                #end
            </div>
        </div>
    </div>
    <div class="tabs-pane" id="tab-win-status-2">
        <h2 class="centered">В разработке</h2>
    </div>
</div>



